# Yakeru-USB トラブルシューティング

## よくある問題と解決方法

### 画面遷移が機能しない場合:

- **原因**: UIWizard と UIWizardScreenController の参照が正しく設定されていない
- **解決方法**: 
  - インスペクタで両者の相互参照が正しく設定されているか確認
  - UIWizard の Screen Controller フィールドが設定されているか確認
  - ScreenController の UI Wizard フィールドが設定されているか確認

### 進捗表示が更新されない場合:

- **原因**: イベント購読の問題またはWebSocket接続の問題
- **解決方法**:
  - コンソールログでエラーメッセージを確認
  - ISOManager のイベント購読が正しく設定されているか確認
  - WebSocketClient が適切に接続されているか確認（バックエンドサーバーが実行されているか）
  - ポーリング間隔が適切か確認（WebSocketClient内のpollInterval値）

### エラーメッセージが表示されない場合:

- **原因**: エラーハンドラーが正しく設定されていない
- **解決方法**:
  - OnWriteError イベントの購読を確認
  - エラーメッセージ用のUI要素が正しく設定されているか確認

### USBデバイスが検出されない場合:

- **原因**: デバイス検出の問題または権限不足
- **解決方法**:
  - USB機器が正しく接続されているか確認
  - 「更新」ボタンをクリックして再スキャン
  - アプリケーションを管理者権限で実行（Windows）
  - Linuxの場合はudevルールが正しく設定されているか確認

## 書き込みに関する注意

- 書き込みプロセスを開始したら、デバイスの安全性を確保するために**プロセスを途中でキャンセルすることはできません**
- 完了するまでアプリケーションを閉じたり、USBデバイスを抜いたりしないでください
- 書き込み中に強制終了すると、USBデバイスが破損する可能性があります

## ログの確認方法

問題解決にはログを確認することが重要です:

1. Unity エディタのコンソールウィンドウでエラーメッセージを確認
2. バックエンドサーバーのコンソール出力を確認
3. WebSocketClient の `enablePollingDebugLogs` を true に設定してデバッグログを有効化

## コード上の注意点

- UIWizard と UIWizardScreenController は密接に連携していますが、責務は明確に分離しています
- UIWizard はアプリケーションロジックを管理し、UIWizardScreenController は画面表示のみを担当します
- イベント通知は基本的に UIWizard から UIWizardScreenController への一方向で行います
